generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int       @id @default(autoincrement())
  name       String
  email      String    @unique
  phone      String    @unique
  password   String? // For email/password login
  googleId   String?   @unique // For Google OAuth
  appleId    String?   @unique // For Apple OAuth
  profilePic String? // User profile picture URL
  feedback   Boolean   @default(true)
  isGuest    Boolean   @default(false)
  bookings   Booking[]
  botToken   String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model ParkingArea {
  id             Int           @id @default(autoincrement())
  city           String
  name           String        @unique
  totalSlots     Int
  address        String?
  slots          ParkingSlot[]
  long           Float
  lat            Float
  features       String[]
  price_per_hour Float
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

model ParkingSlot {
  id          Int         @id @default(autoincrement())
  parkingArea ParkingArea @relation(fields: [parkingId], references: [id])
  parkingId   Int
  slotNumber  String
  bookings    Booking[]
}

model Booking {
  id             Int           @id @default(autoincrement())
  bookind_id     String        @unique @default(cuid())
  user           User?         @relation(fields: [userId], references: [id])
  userId         Int?
  slot           ParkingSlot   @relation(fields: [slotId], references: [id])
  slotId         Int
  startTime      DateTime
  endTime        DateTime
  vehicle_number String?
  phone          String
  bookingStatus  BookingStatus @default(PENDING)
  paymentStatus  PaymentStatus @default(PENDING)
  paymentId      String?
  paymentMethod  String?

  refundId     String?
  refundAmount Float?
  refundedAt   DateTime?

  // ✅ NEW: Entry/Exit tracking (for AI camera QR scanning)
  entryScanned Boolean   @default(false)
  entryTime    DateTime?
  exitScanned  Boolean   @default(false)
  exitTime     DateTime?

  active    Boolean   @default(false)
  status    String    @default("available") // available, expired
  amount    Float
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  EXPIRED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  PAID
  FAILED
  REFUNDED
  PARTIAL_REFUND // ✅ NEW: For partial refunds (75%, 50%, 25%)
}
